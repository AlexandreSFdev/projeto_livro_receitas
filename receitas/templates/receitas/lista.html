{% extends 'receitas/base.html' %}

{% block title %}Todas as Receitas{% endblock %}

{% block content %}
<div class="text-center mb-5">
    <h1 class="display-4 text-white fw-bold mb-3">
        <i class="bi bi-book-half"></i> Descubra Receitas Incríveis
    </h1>
    <p class="lead text-white">Explore, crie e compartilhe suas receitas favoritas</p>
    {% if user.is_authenticated %}
    <a href="{% url 'criar_receita' %}" class="btn btn-primary btn-lg mt-3">
        <i class="bi bi-plus-circle"></i> Adicionar Nova Receita
    </a>
    {% endif %}
</div>

<!-- Barra de Busca e Filtros -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <!-- Busca por texto -->
            <div class="col-md-5">
                <div class="input-group input-group-lg">
                    <span class="input-group-text">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" 
                           name="busca" 
                           class="form-control" 
                           placeholder="Buscar receitas..." 
                           value="{{ busca }}">
                </div>
            </div>
            
            <!-- Filtro por dificuldade -->
            <div class="col-md-2">
                <select name="dificuldade" class="form-select form-select-lg">
                    <option value="">Dificuldade</option>
                    <option value="facil" {% if dificuldade == 'facil' %}selected{% endif %}>Fácil</option>
                    <option value="medio" {% if dificuldade == 'medio' %}selected{% endif %}>Médio</option>
                    <option value="dificil" {% if dificuldade == 'dificil' %}selected{% endif %}>Difícil</option>
                </select>
            </div>
            
            <!-- Filtro por tempo -->
            <div class="col-md-2">
                <select name="tempo_max" class="form-select form-select-lg">
                    <option value="">Tempo máx.</option>
                    <option value="15" {% if tempo_max == '15' %}selected{% endif %}>15 min</option>
                    <option value="30" {% if tempo_max == '30' %}selected{% endif %}>30 min</option>
                    <option value="60" {% if tempo_max == '60' %}selected{% endif %}>1 hora</option>
                    <option value="120" {% if tempo_max == '120' %}selected{% endif %}>2 horas</option>
                </select>
            </div>
            
            <!-- Ordenação -->
            <div class="col-md-2">
                <select name="ordenar" class="form-select form-select-lg">
                    <option value="mais_recentes" {% if ordenar == 'mais_recentes' %}selected{% endif %}>Mais recentes</option>
                    <option value="mais_antigas" {% if ordenar == 'mais_antigas' %}selected{% endif %}>Mais antigas</option>
                    <option value="tempo_crescente" {% if ordenar == 'tempo_crescente' %}selected{% endif %}>Menos tempo</option>
                    <option value="tempo_decrescente" {% if ordenar == 'tempo_decrescente' %}selected{% endif %}>Mais tempo</option>
                    <option value="melhor_avaliadas" {% if ordenar == 'melhor_avaliadas' %}selected{% endif %}>Melhor avaliadas</option>
                </select>
            </div>
            
            <!-- Botão de buscar -->
            <div class="col-md-1">
                <button type="submit" class="btn btn-primary w-100 btn-lg">
                    <i class="bi bi-funnel"></i>
                </button>
            </div>
        </form>
        
        <!-- Limpar filtros -->
        {% if busca or dificuldade or tempo_max %}
        <div class="mt-3">
            <a href="{% url 'lista_receitas' %}" class="btn btn-outline-secondary">
                <i class="bi bi-x-circle"></i> Limpar filtros
            </a>
            <span class="text-muted ms-2">
                Mostrando {{ receitas.count }} resultado{{ receitas.count|pluralize }}
            </span>
        </div>
        {% endif %}
    </div>
</div>

<!-- Grid de Receitas -->
<div class="row g-4">
    {% for receita in receitas %}
    <div class="col-md-6 col-lg-4">
        <div class="card h-100">
            {% if receita.foto %}
            <img src="{{ receita.foto.url }}" class="card-img-top" alt="{{ receita.titulo }}">
            {% else %}
            <div class="card-img-top bg-gradient d-flex align-items-center justify-content-center" 
                 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 250px;">
                <i class="bi bi-image" style="font-size: 4rem; color: white;"></i>
            </div>
            {% endif %}
            
            <div class="card-body">
                <h5 class="card-title fw-bold">{{ receita.titulo }}</h5>
                <p class="card-text text-muted">{{ receita.descricao|truncatewords:15 }}</p>
                
                <div class="recipe-meta mb-3">
                    <span><i class="bi bi-clock"></i> {{ receita.tempo_preparo }} min</span>
                    <span><i class="bi bi-people"></i> {{ receita.porcoes }} porções</span>
                </div>
                
                <div class="d-flex justify-content-between align-items-center">
                    <span class="badge bg-primary">{{ receita.get_dificuldade_display }}</span>
                    {% if receita.media_avaliacoes %}
                    <span class="rating">
                        <i class="bi bi-star-fill"></i> {{ receita.media_avaliacoes|floatformat:1 }}
                    </span>
                    {% endif %}
                </div>
                
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="bi bi-person"></i> {{ receita.autor.username }}
                    </small>
                </div>
            </div>
            
            <div class="card-footer bg-white border-0 pb-3">
                <a href="{% url 'detalhe_receita' receita.pk %}" class="btn btn-primary w-100">
                    <i class="bi bi-eye"></i> Ver Receita
                </a>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="card text-center py-5">
            <div class="card-body">
                <i class="bi bi-inbox" style="font-size: 4rem; color: #ccc;"></i>
                {% if busca or dificuldade or tempo_max %}
                <h3 class="mt-3">Nenhuma receita encontrada</h3>
                <p class="text-muted">Tente ajustar os filtros de busca</p>
                <a href="{% url 'lista_receitas' %}" class="btn btn-outline-primary mt-3">
                    <i class="bi bi-arrow-left"></i> Ver todas as receitas
                </a>
                {% else %}
                <h3 class="mt-3">Nenhuma receita ainda</h3>
                <p class="text-muted">Seja o primeiro a adicionar uma receita deliciosa!</p>
                {% if user.is_authenticated %}
                <a href="{% url 'criar_receita' %}" class="btn btn-primary mt-3">
                    <i class="bi bi-plus-circle"></i> Criar Primeira Receita
                </a>
                {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<style>
    .input-group-text {
        background: white;
        border-right: none;
    }
    
    .input-group .form-control {
        border-left: none;
    }
    
    .input-group .form-control:focus {
        border-color: #dee2e6;
        box-shadow: none;
    }
    
    select.form-select,
    input.form-control {
        border: 2px solid #e0e0e0;
        border-radius: 8px;
    }
    
    select.form-select:focus,
    input.form-control:focus {
        border-color: var(--primary);
    }
</style>
{% endblock %}